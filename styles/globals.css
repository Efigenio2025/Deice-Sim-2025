:root{
  --bg:#0b0c10; --card:#101218; --ink:#eaeaea; --muted:#96a3bf; --line:#1e2230;
  --accent:#1f6feb; --danger:#e5534b; --ok:#19c37d; --radius:16px; --tap:48px; --space:18px
}
*{box-sizing:border-box}
html,body{padding:0;margin:0}
body{
  background:var(--bg); color:var(--ink);
  font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
  -webkit-text-size-adjust:100%; -webkit-tap-highlight-color:transparent
}
.wrap{max-width:980px;margin:0 auto;padding:24px;display:flex;flex-direction:column;gap:18px}
.row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
.btn{appearance:none;border:0;border-radius:12px;background:var(--accent);
  color:#fff;font-weight:800;padding:12px 16px;cursor:pointer;min-height:48px;text-decoration:none}
.ghost{background:#2b3147}
.danger{background:var(--danger)}
.card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:18px}
.status{font-size:.92rem;color:var(--muted)}
.pill{display:inline-block;background:#16213a;border:1px solid #223259;color:#b7c7ff;border-radius:999px;padding:2px 8px;font-size:.8rem;font-weight:700}
.live-inline{width:100%;border:1px solid #223259;border-radius:10px;padding:10px;background:#141822;color:#b7c7ff;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.progress{height:12px;background:#1a2136;border:1px solid #223259;border-radius:999px;overflow:hidden}
.bar{height:100%;width:0;background:linear-gradient(90deg,#e5534b,#f89c2c,#f6e05e,#a4e786,#19c37d);transition:width .25s}
.scoreline{display:flex;justify-content:space-between;align-items:center;margin-top:8px}
.hidden{display:none!important}
/* Duolingo-style tokens */
.tok{display:inline-block;padding:0 4px;border-radius:6px;margin:0 2px 4px 0}
.ok{background:#12291c;border:1px solid #1f5d38}
.miss{background:#2a1616;border:1px solid #8a2c2c;text-decoration:underline}
.extra{background:#1a1d2a;border:1px solid #2f375c;opacity:.9}
/* --- Responsive layout for trainer --- */
.train-wrap.desktop {
  display: grid;
  grid-template-columns: 1.25fr 0.85fr;
  gap: 16px;
}

.train-wrap.mobile {
  display: grid;
  grid-template-columns: 1fr;
  gap: 12px;
}

@media (max-width: 860px) {
  .log { height: 140px; }
}

@media (max-width: 480px) {
  body { font-size: 15px; }
  .log { height: 120px; }
}
/* ===== Piedmont Bright Theme ===== */
:root{
  --bg-start:#e9f3ff;        /* brighter sky gradient */
  --bg-mid:#cfe6ff;
  --bg-end:#9fc9ff;
  --card:#ffffff;            /* bright cards */
  --ink:#0b1e39;             /* dark ink */
  --muted:#47608a;
  --accent:#0e63ff;
  --border:#d8e6ff;
  --chip:#f1f6ff;
  --ok:#19b56b;
  --err:#ff5c6c;
}

body.piedmont {
  background-image:
    linear-gradient(180deg, var(--bg-start), var(--bg-mid) 40%, var(--bg-end)),
    url("/images/plane-spray.jpg");
  background-repeat: no-repeat;
  background-position: right -60px top;
  background-size: 1920px auto;
  background-attachment: fixed;
  color: var(--ink);
}


/* container + card */
.pm-app { max-width: 1120px; margin: 24px auto; padding: 0 16px; }
.pm-card { background: var(--card); border: 1px solid var(--border); border-radius: 16px;
  box-shadow: 0 12px 36px rgba(5,30,74,.12); overflow: hidden; }

/* header */
.pm-header { display:flex; justify-content:space-between; align-items:center; gap:12px; flex-wrap:wrap;
  padding: 10px 14px; border-bottom: 1px solid var(--border); background: linear-gradient(#fff, #f8fbff); }
.pm-title { display:flex; align-items:center; gap:10px; }
.pm-titleBrand { display:flex; align-items:center; gap:10px; }
.pm-titleBrand img { height: 108px; }
.pm-title h1 { margin:0; font: 700 17px/1 system-ui, -apple-system, Segoe UI, Roboto; }
.pm-badge { background: var(--chip); border: 1px solid var(--border); color: var(--muted);
  border-radius: 999px; padding: 4px 9px; font-size: 11px; }
.pm-title { flex:1 1 auto; min-width:0; }
.pm-titleBrand { flex:1 1 auto; min-width:0; }
.pm-titleText { min-width:0; }

.pm-headerLeft { display:flex; align-items:center; gap:12px; flex:1 1 320px; min-width:0; }
.pm-headerRight { display:flex; align-items:center; gap:12px; justify-content:flex-end; flex:1 1 280px; min-width:0; flex-wrap:wrap; }
.pm-headerScore { display:flex; align-items:center; justify-content:center; flex-shrink:0; }
.pm-titleText { display:flex; flex-direction:column; gap:4px; }
.pm-titleBadge { align-self:flex-start; }
.pm-headerRight .pm-statusGroup { flex:1 1 auto; min-width:160px; justify-content:flex-end; }
.pm-headerRight .pm-mic { flex:1 1 220px; justify-content:flex-end; }
.pm-headerRight .pm-meter { min-width:120px; }
.pm-header.desktop .pm-titleBadge { display:inline-flex; }
.pm-header.mobile .pm-titleBadge { display:none; }
.pm-header.mobile {
  display:grid;
  grid-template-columns:minmax(0,1fr) auto;
  grid-template-areas:
    "brand score"
    "status status"
    "mic mic";
  padding:8px 12px;
  gap:8px 12px;
  align-items:start;
}
.pm-header.mobile .pm-headerSection { display:flex; align-items: flex-start; gap:8px; min-width:0; }
.pm-header.mobile .pm-headerBrand { grid-area: brand; }
.pm-header.mobile .pm-headerScoreWrap { grid-area: score; justify-content:flex-end; }
.pm-header.mobile .pm-headerScore { justify-content:flex-end; }
.pm-header.mobile .pm-headerStatus { grid-area: status; }
.pm-header.mobile .pm-headerMic { grid-area: mic; }
.pm-header.mobile .pm-statusGroup { width:100%; justify-content:flex-start; gap:6px; flex-wrap:wrap; }
.pm-header.mobile .pm-statusGroup.pm-statusGroupCompact { gap:6px; }
.pm-header.mobile .pm-statusGroup.pm-statusGroupCompact .pm-pill { flex:1 1 auto; min-width:0; }
.pm-header.mobile .pm-mic { width:100%; justify-content:space-between; }
.pm-header.mobile .pm-meter { flex:1 1 auto; min-width:0; }
.pm-header.mobile .pm-titleBrand img { height: clamp(38px, 16vw, 54px); }
.pm-header.mobile .pm-titleText h1 { font-size: clamp(13px, 4vw, 15px); line-height:1.2; }
.pm-titleText h1 { margin:0; }

/* main grid */
.pm-main { display:grid; gap:16px; padding:16px; }
.pm-main.desktop { grid-template-columns: 1.25fr .9fr; }
.pm-main.mobile  { grid-template-columns: 1fr; }

.pm-scenarioControl { align-items:center; gap:6px; }
.pm-statusGroup { display:flex; align-items:center; gap:6px; flex-wrap:wrap; justify-content:flex-end; }
.pm-statusGroup.pm-statusGroupCompact { gap:4px; flex-wrap:nowrap; justify-content:flex-start; }
.pm-runRow {
  display:flex;
  justify-content:flex-start;
  align-items:stretch;
  gap:12px;
  flex-wrap:nowrap;
  overflow-x:auto;
  padding-bottom:4px;
}
.pm-controlBlock {
  display:flex;
  flex-direction:column;
  gap:6px;
  align-items:stretch;
  flex:1 1 160px;
  min-width:160px;
}
.pm-controlBlock .pm-btn { width:100%; }
.pm-speechToggle { gap:8px; align-items:center; flex-wrap:nowrap; justify-content:space-between; width:100%; }
.pm-runToggle { gap:8px; align-items:center; flex-wrap:nowrap; justify-content:space-between; width:100%; }
.pm-switchOption { font-size:12px; color:var(--muted); font-weight:600; white-space:nowrap; }
.pm-switchOption.active { color:var(--ink); }
.pm-switch { display:inline-flex; align-items:center; justify-content:center; border:none; background:transparent;
  padding:4px; cursor:pointer; position:relative; border-radius:16px; }
.pm-switch:focus-visible { outline:2px solid #0e63ff; outline-offset:2px; }
.pm-switchTrack { width:46px; height:24px; border-radius:999px; border:1px solid var(--border);
  background:#dbe7ff; position:relative; transition:background .2s ease, border-color .2s ease; }
.pm-switchThumb { width:18px; height:18px; border-radius:50%; background:#fff; position:absolute;
  top:2px; left:2px; transition:transform .2s ease; box-shadow:0 2px 6px rgba(10,44,97,.2); }
.pm-switch.manual .pm-switchTrack { background:#0e63ff; border-color:#0e63ff; }
.pm-switch.manual .pm-switchThumb { transform:translateX(24px); }
.pm-switch.on .pm-switchTrack { background:#0e63ff; border-color:#0e63ff; }
.pm-switch.on .pm-switchThumb { transform:translateX(24px); }
.pm-navRow, .pm-checkRow, .pm-awaitRow { gap:8px; align-items:center; flex-wrap:wrap; }
.pm-progressRow { justify-content:space-between; align-items:flex-start; gap:12px; flex-wrap:wrap; }
.pm-exportRow { justify-content:flex-end; gap:10px; flex-wrap:wrap; }

/* panels */
.pm-panel { background: #e2e8f0; border: 1px solid var(--border); border-radius: 12px; padding: 12px; }
.pm-panel.pm-scenarioPanel { padding: 6px 10px; display:flex; align-items:center; }
.pm-scenarioPanel .pm-select { width:100%; padding:6px 8px; font-size:12px; }
.pm-scenarioSelect { flex:1 1 auto; min-width:0; }
.pm-srOnly {
  position:absolute;
  width:1px;
  height:1px;
  padding:0;
  margin:-1px;
  overflow:hidden;
  clip:rect(0,0,0,0);
  white-space:nowrap;
  border:0;
}
.pm-row { display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
.pm-label { color: var(--muted); font-size: 11px; }
.pm-select, .pm-input, textarea { width:100%; background:#f6f9ff; border:1px solid var(--border); color:var(--ink);
  border-radius:10px; padding:8px 10px; font-size:13px; }
.pm-btn { cursor:pointer; border:1px solid var(--border); background:#f2f7ff; color:var(--ink);
  border-radius:12px; padding:10px 14px; font-weight:600; }
.pm-btn.pm-mobileControl { flex:1 1 0; min-width:0; }
.pm-btn.pm-mobileNavBtn { flex:1 1 0; min-width:0; padding:8px 10px; font-size:13px; white-space:nowrap; }
.pm-btn.primary.pm-mobileNavBtn { padding:8px 10px; }
.pm-btn.primary { background: linear-gradient(180deg, #2f78ff, #0e63ff); color:#fff; border-color:#0e63ff; }
.pm-btn.ghost { background:transparent; }


/* mic widget */
.pm-mic { display:flex; align-items:center; gap:8px; }
.pm-pill { display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border:1px solid var(--border);
  border-radius:999px; background:#f6f9ff; color:#34507a; font-size:12px; }
.pm-header .pm-pill { padding:5px 9px; font-size:11px; }
.pm-pill.pm-pillWarn { background:#fff4d6; border-color:#f0c36d; color:#5b3d00; }
.pm-manualNotice { margin-top:10px; }
.pm-pill.pm-pillCompact { padding:4px 8px; font-size:11px; min-width:0; justify-content:center; white-space:nowrap; }
.pm-header .pm-pill.pm-pillCompact { padding:3px 7px; font-size:10px; }
.pm-meter { flex:1; height:8px; background:#eef5ff; border:1px solid var(--border);
  border-radius:999px; overflow:hidden; }
.pm-fill { height:100%; background:#19b56b; }
.pm-mic.compact { gap:6px; }
.pm-mic.compact .pm-meter { height:6px; }
.pm-mic.compact .pm-pill { padding:3px 7px; font-size:10px; }

/* “coach” bubble */
.pm-coach { font-size:15px; background:#f6f9ff; border-left:3px solid var(--accent); padding:12px; border-radius:8px; }

/* log */
.pm-log { height: 170px; overflow:auto; background:#fbfdff; border:1px dashed var(--border);
  border-radius:8px; padding:10px; font-family:ui-monospace, Menlo, Consolas, monospace; font-size:12px; white-space:pre-wrap; }

/* stepper */
.pm-stepper { display:flex; gap:6px; flex-wrap:wrap; }
.pm-step { width:14px; height:14px; border-radius:6px; border:1px solid var(--border); background:#eaf2ff; }
.pm-step.cur  { outline:2px solid var(--accent); }
.pm-step.ok   { background:#d6f7e9; }
.pm-step.miss { background:#ffe3e6; }

/* diff */
.pm-diffBlock { margin-top:12px; }
.pm-diffBlock .pm-label { margin-bottom:4px; display:block; }
.pm-diff { padding:8px; border-radius:8px; background:#f6f9ff; margin:8px 0; }
.pm-wok { color:#0f7a4a; }
.pm-wmiss { color:#b00d2d; text-decoration: underline dotted; }
.pm-wextra { color:#4a5a7d; font-style: italic; }

/* score ring */
.pm-scoreRow { display:flex; align-items:center; gap:12px; }
.pm-scoreDetails { display:flex; flex-direction:column; gap:6px; }
.pm-ring { display:block; }

.pm-progressTop { margin-bottom: 12px; }
.pm-progressTop .pm-progressRow { margin-top: 0; }
.pm-navRow.pm-navRowCompact { flex-direction: row; flex-wrap: nowrap; gap:6px; }
.pm-navRow.pm-navRowCompact .pm-btn { width:auto; }

/* footer */
.pm-footer { padding:12px 16px; border-top:1px solid var(--border); display:flex; justify-content:space-between;
  color:#47608a; font-size:12px; background:linear-gradient(#f8fbff,#fff); }

/* toasts */
.pm-toasts { position:fixed; right:16px; bottom:16px; display:flex; flex-direction:column; gap:8px; z-index:9999; }
.pm-toast { background:#ffffff; border:1px solid var(--border); color:#0b1e39; padding:10px 12px; border-radius:10px;
  box-shadow:0 6px 20px rgba(5,30,74,.12); }
.pm-toast.success{ border-color:#19b56b }
.pm-toast.error{ border-color:#ff5c6c }

/* responsive */
@media (hover:none) and (pointer:coarse){
  .pm-btn, .pm-select, .pm-input, textarea { min-height:44px }
  .pm-scenarioPanel .pm-select { min-height:38px; }
}
@media (max-width: 860px){
  .pm-main{ padding:12px }
  .pm-log{ height:140px }
  body.piedmont{ background:#000; background-image:none; }
  .pm-scenarioPanel{ margin:0 12px; }
}
@media (max-width: 720px){
  .pm-app{ margin:16px auto; padding:0 12px; }
  .pm-card{ border-radius:14px; }
  .pm-titleBrand img{ height:110px; }
  .pm-statusGroup{ width:100%; }
  .pm-statusGroup .pm-pill{ width:100%; text-align:center; }
  .pm-scenarioPanel .pm-scenarioControl{ flex-direction:column; align-items:stretch; }
  .pm-scenarioPanel .pm-label{ width:100%; }
  .pm-scenarioPanel .pm-select{ width:100%; }
  .pm-runRow{ flex-direction:column; align-items:stretch; }
  .pm-navRow{ flex-direction:column; align-items:stretch; }
  .pm-navRow .pm-btn{ width:100%; }
  .pm-checkRow{ flex-direction:column; align-items:stretch; }
  .pm-checkRow .pm-btn{ width:100%; }
  .pm-awaitRow{ flex-direction:column; align-items:stretch; }
  .pm-awaitRow .pm-btn{ width:100%; }
  .pm-scoreRow{ flex-direction:column; align-items:flex-start; }
  .pm-progressRow{ flex-direction:column; align-items:stretch; }
  .pm-exportRow{ flex-direction:column; align-items:stretch; }
  .pm-exportRow .pm-btn{ width:100%; }
  .pm-footer{ flex-direction:column; align-items:flex-start; gap:8px; }
}
@media (max-width: 480px){
  .pm-log{ height:120px }
  .pm-titleBrand img{ height:clamp(48px, 18vw, 68px); }
}

@media (max-width: 380px) {
  .pm-panel {
    padding: 10px;
  }

  .pm-btn.pm-mobileNavBtn {
    font-size: 12px;
    padding: 8px;
  }

  .pm-btn.pm-mobileControl {
    padding: 9px 12px;
  }
}

@media (max-width: 340px) {
  .pm-panel {
    padding: 8px;
  }

  .pm-btn {
    padding: 8px 10px;
  }

  .pm-pill {
    font-size: 11px;
  }
}

.pm-scoreRow.pm-scoreRowCompact {
  align-items: flex-start;
}

.pm-scoreRow.pm-scoreRowCompact .pm-scoreDetails {
  width: 100%;
}

.pm-scenarioPanel { margin: 0 14px; background:#f6f9ff; }
.pm-scenarioPanel .pm-scenarioControl { width:100%; justify-content:space-between; gap:6px; }
.pm-scenarioPanel .pm-select { flex:1 1 220px; min-width:0; padding:6px 8px; font-size:12px; }
.pm-scenarioPanel.mobile { margin: 5px 10px; padding:5px 8px; background:#f8fbff; }
.pm-scenarioPanel.mobile .pm-scenarioControl { gap:6px; align-items:center; }
.pm-scenarioPanel.mobile .pm-label { font-size:9.5px; letter-spacing:0.03em; }
.pm-scenarioPanel.mobile .pm-select { padding:5px 7px; font-size:11px; }
/* Put pill + meter side-by-side and align */
.pm-header.mobile .pm-headerMic { display: flex; } /* already covered by .pm-headerSection, but explicit here */

/* Mic row layout */
.pm-header.mobile .pm-mic {
  display: flex;           /* ← key */
  align-items: center;
  gap: 8px;
  width: 100%;
}

/* Keep the pill snug, let the meter grow */
.pm-header.mobile .pm-mic .pm-pill { 
  flex: 0 0 auto; 
  white-space: nowrap;
}

/* Progress bar stretches to fill remaining space */
.pm-header.mobile .pm-mic .pm-meter {
  flex: 1 1 140px;         /* grows, but has a sensible base */
  min-width: 0;            /* prevents overflow with long labels */
}

/* Optional: ensure the inner fill never overflows rounded corners etc. */
.pm-header.mobile .pm-mic .pm-meter .pm-fill {
  width: 0%;               /* will be set inline by JS */
  height: 100%;
}

